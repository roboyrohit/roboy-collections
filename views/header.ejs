<!DOCTYPE html>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script> -->
<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script> -->
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script type="text/javascript"
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.10.18/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src='https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js'></script>
<script type="text/javascript" src='https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js'></script>
<link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/jquery.dataTables.min.css" />
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/buttons/1.5.6/css/buttons.dataTables.min.css" />


<style>
    .header {
        position: sticky !important;
        top: 0 !important;
        left: 0 !important;
        height: 60px !important;
        width: 100vw !important;
        z-index: 2;
        border-bottom-left-radius: 20px;
        border-bottom-right-radius: 20px;
        box-shadow: rgba(0, 0, 0, 0.07) 0px 1px 2px, rgba(0, 0, 0, 0.07) 0px 2px 4px, rgba(0, 0, 0, 0.07) 0px 4px 8px, rgba(0, 0, 0, 0.07) 0px 8px 16px, rgba(0, 0, 0, 0.07) 0px 16px 32px, rgba(0, 0, 0, 0.07) 0px 32px 64px;
    }

    .logo:hover {
        transform: scale(1.125);
        background-color: aliceblue;
        border-radius: 5px;
        box-shadow: rgba(0, 0, 0, 0.07) 0px 1px 2px, rgba(0, 0, 0, 0.07) 0px 2px 4px, rgba(0, 0, 0, 0.07) 0px 4px 8px, rgba(0, 0, 0, 0.07) 0px 8px 16px, rgba(0, 0, 0, 0.07) 0px 16px 32px, rgba(0, 0, 0, 0.07) 0px 32px 64px;
    }

    .btn-head {
        font-size: 13px !important;
        color: aliceblue !important;
        font-weight: bold !important;
        width: 'fit-content' !important;
    }

    .btn-head:hover {
        box-shadow: rgba(6, 24, 44, 0.4) 0px 0px 0px 2px,
            rgba(6, 24, 44, 0.65) 0px 4px 6px -1px,
            rgba(255, 255, 255, 0.08) 0px 1px 0px inset;
        color: black !important;
        background-color: whitesmoke !important;
    }

    .btn-auth {
        box-shadow: rgba(6, 24, 44, 0.4) 0px 0px 0px 2px, rgba(6, 24, 44, 0.65) 0px 4px 6px -1px, rgba(255, 255, 255, 0.08) 0px 1px 0px inset;
        background-color: aliceblue !important;
        color: blue !important;
    }

    .navbar-text {
        margin-right: 15px;
        max-width: 380px !important;
        font-size: small;
        font-weight: bold;
        text-align: justify;
    }

    .navbar-text:hover {
        color: azure;
        text-shadow: 2px 2px 4px #000000;
    }

    ul.dropdown-menu {
        min-width: 130px !important;
        background-color: whitesmoke !important;
        border: 2px solid black !important;
    }

    a.dropdown-item {
        /* font-size: 14px !important; */
        font-weight: bold !important;
        color: black !important;
    }

    a.dropdown-item:hover {
        color: whitesmoke !important;
    }

    .nav-item {
        margin-left: 0px !important;
        margin-right: -9px !important;
    }

    #WishModalLabel {
        animation-name: blink;
        animation-duration: 1s;
        animation-timing-function: ease-in;
        animation-iteration-count: Infinite;
        filter: drop-shadow(0 0 0.75rem crimson);
    }

    .happyRobo {
        display: block !important;
        width: 10% !important;
        filter: drop-shadow(0 0 0.15rem black);
    }

    .wishInfo {
        margin-top: 20px;
        font-weight: bolder;
        font-size: 17px !important;
        text-align: justify !important;
        text-transform: uppercase;
        text-shadow: 1px 1px 1px black !important;
        letter-spacing: 1px;
        animation-name: blink;
        animation-duration: 2s;
        animation-timing-function: ease-in;
        animation-iteration-count: Infinite;
    }

    .center {
        max-width: 100%;
    }

    .mb-3 {
        margin-block: 5% !important;
        align-items: center;
    }

    .btn-sign,
    .btn-pswrd {
        transition: all !important;
        transition: 0.9s !important;
    }

    .btn-sign:hover {
        width: 45% !important;
        box-shadow: rgba(255, 99, 71, 0.9) 0px 2px 4px 0px, rgba(255, 99, 71, 0.7) 0px 2px 16px 0px;
    }

    .btn-pswrd:hover {
        width: 38% !important;
        box-shadow: rgba(255, 99, 71, 0.9) 0px 2px 4px 0px, rgba(255, 99, 71, 0.7) 0px 2px 16px 0px;
    }

    .animated {
        box-shadow: tomato 3px 3px 6px 0px inset, tomato -3px -3px 6px 1px inset;
        -webkit-animation-duration: 1s;
        animation-duration: 1s;
        -webkit-animation-fill-mode: both;
        animation-fill-mode: both;
        transition: all ease-in-out;
    }

    .wiggle {
        -webkit-animation-name: shake;
        animation-name: shake;
    }

    @-webkit-keyframes shake {

        from,
        to {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }

        10%,
        30%,
        50%,
        70%,
        90% {
            -webkit-transform: translate3d(-10px, 0, 0);
            transform: translate3d(-10px, 0, 0);
        }

        20%,
        40%,
        60%,
        80% {
            -webkit-transform: translate3d(10px, 0, 0);
            transform: translate3d(10px, 0, 0);
        }
    }

    @keyframes shake {

        from,
        to {
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
        }

        10%,
        30%,
        50%,
        70%,
        90% {
            -webkit-transform: translate3d(-10px, 0, 0);
            transform: translate3d(-10px, 0, 0);
        }

        20%,
        40%,
        60%,
        80% {
            -webkit-transform: translate3d(10px, 0, 0);
            transform: translate3d(10px, 0, 0);
        }
    }

    @keyframes blink {
        0% {
            color: red;
        }

        50% {
            color: cyan;
        }

        100% {
            color: yellowgreen;
        }
    }
</style>

<nav class="navbar navbar-expand-lg bg-primary header" data-bs-theme="dark">
    <div class="container-fluid">
        <a class="navbar-brand" style="vertical-align: middle; margin-left: 10px;" href="/"><img class="logo"
                src="Roboy Collections.png" height="40px" alt="robo-scull" /></a>
        <div class="collapse navbar-collapse" id="navbarText">
            <% if(session.Type=="Admin" ) {%>
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" href="/database">
                            <button class="btn btn-head"><i class="bi bi-database"></i> DataBase</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/movies">
                            <button class="btn btn-head"><i class="bi bi-film"></i> Movies</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/series">
                            <button class="btn btn-head"><i class="bi bi-camera-reels"></i> Series</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/genre">
                            <button class="btn btn-head"><i class="bi bi-list-columns"></i> Genre</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/year">
                            <button class="btn btn-head"><i class="bi bi-calendar-week"></i> Year</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/isro_home">
                            <button class="btn btn-head"><i class="bi bi-rocket"></i> ISRO</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/testMongoDB">
                            <button class="btn btn-head"><i class="bi bi-database"></i> MongoDB</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active">
                            <button class="btn btn-head" onclick="$('#InfoModal').modal('show');"><i
                                    class="bi bi-binoculars"></i> Asha Activity</button>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active">
                            <button class="btn btn-head" onclick="$('#WishModal').modal('show');"><i
                                    class="bi bi-box2-heart"></i> Wishes</button>
                        </a>
                    </li>
                </ul>
                <% } else if (session.Type=="General User" ) { %>
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" href="/movies">
                                <button class="btn btn-head"><i class="bi bi-film"></i> Movies</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/series">
                                <button class="btn btn-head"><i class="bi bi-camera-reels"></i> Series</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/genre">
                                <button class="btn btn-head"><i class="bi bi-list-columns"></i> Genre</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/year">
                                <button class="btn btn-head"><i class="bi bi-calendar-week"></i> Year</button>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="/isro_home">
                                <button class="btn btn-head"><i class="bi bi-rocket"></i> ISRO</button>
                            </a>
                        </li>
                    </ul>
                    <span class="navbar-text">
                        These movies / Series are collected / watched by me over the years and will be featured new
                        Movies /
                        Series Details.
                    </span>
                    <%} else { %>
                        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                            <li class="nav-item">
                                <a class="nav-link active" href="/isro_home">
                                    <button class="btn btn-head"><i class="bi bi-rocket"></i> ISRO</button>
                                </a>
                            </li>
                        </ul>
                        <span class="navbar-text">
                            These movies / Series are collected / watched by me over the years and will be featured new
                            Movies / Series Details.
                        </span>
                        <% } %>

                            <ul class="navbar-nav mb-2 mb-lg-0">
                                <% if(session.LoginID>=0) {%>
                                    <div class="dropdown dropleft">
                                        <button class="btn btn-head btn-auth dropdown-toggle" type="button"
                                            id="userProfile" data-bs-toggle="dropdown" aria-expanded="false">
                                            <i class="bi bi-person"></i>
                                            <%=session.LoginName%>
                                        </button>
                                        <ul class="dropdown-menu" aria-labelledby="userProfile">
                                            <li><a class="dropdown-item" href="/profile"><i
                                                        class="bi bi-file-earmark-person"></i>
                                                    Profile</a></li>
                                            <!-- <li><a class="dropdown-item" onclick="$('#chngePswd').modal('show');"><i
                                                        class="bi bi-fingerprint"></i> Change
                                                    Password</a></li> -->
                                            <li><a class="dropdown-item" href="/logout"><i class="bi bi-door-open"></i>
                                                    Logout</a></li>
                                        </ul>
                                    </div>
                                    <%} else { %>
                                        <li class="nav-item">
                                            <a class="nav-link active" href="/reg_user" target="_blank">
                                                <button class="btn btn-head btn-auth"><i class="bi bi-person-add"></i>
                                                    Sign-Up</button>
                                            </a>
                                        </li>
                                        <li class="nav-item">
                                            <a class="nav-link active">
                                                <button class="btn btn-head btn-auth"
                                                    onclick="$('#signIn').modal('show');"><i
                                                        class="bi bi-person-down"></i> Sign-In</button>
                                            </a>
                                        </li>
                                        <% } %>
                            </ul>
        </div>
    </div>
</nav>

<div class="modal fade" id="InfoModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="InfoModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="InfoModalLabel" style="font-weight: bold; color: tomato;">Read Carefully...!
                </h5>
            </div>
            <div class="modal-body" style="text-align: justify;">
                &emsp;&emsp;One of these <b>Robo gif Image</b> has the hyperlink for the <b style="color: blue;">Asha
                    Fun Activity</b>. Find out and click on Images...
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" data-bs-dismiss="modal">OK . . . I Understand . . !</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="signIn" tabindex="-1" role="dialog" aria-labelledby="signInTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div id="Credentials" class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="signInInfo">Sign In With Your Credentials</h2>
            </div>
            <div class="modal-body" style="display: inline-flex !important; justify-items: center;">
                <div style="width: 50% !important;">
                    <img src="gifs/selfie-robo.gif" alt="Selfie Robo" class="center">
                </div>
                <div style="width: 50% !important;">
                    <form id="loginForm">
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="user-addon"><b>@</b></span>
                            </div>
                            <input type="text" id="Username" class="form-control"
                                placeholder="Registered Email-ID or Mobile No..!" aria-describedby="user-addon"
                                autofocus>
                        </div>
                        <div class="input-group mb-3">
                            <div class="input-group-prepend">
                                <span class="input-group-text" id="pswrd-addon"><b>#</b></span>
                            </div>
                            <input type="password" id="Password" class="form-control"
                                placeholder="Enter Your Password..!" aria-describedby="pswrd-addon">
                        </div>
                        <div class="mb-3" align="center">
                            <button type="submit" class="btn btn-primary btn-sign" style="width:100%;"><b>S I G N - I
                                    N</b></button>
                        </div>
                        <a href="/forgot_password" target="_blank">
                            <label style="width:100%; text-align: center; color: tomato; cursor: pointer;"><b>F O R G O
                                    T - P A S S W O R D</b></label>
                        </a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="chngePswd" tabindex="-1" role="dialog" aria-labelledby="chngePswdTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
        <div id="Credentials" class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="chngePswdInfo">Change Your Password</h2>
            </div>
            <div class="modal-body" style="display: inline-flex !important; justify-items: center;">
                <div style="width: 50% !important;">
                    <img src="gifs/write-robo.gif" alt="Selfie Robo" class="center">
                </div>
                <div style="width: 50% !important;">
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="curPswrd-addon"><b>*</b></span>
                        </div>
                        <input type="password" id="curPswrd" class="form-control" placeholder="Current Password..!"
                            aria-describedby="curPswrd-addon" autofocus>
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="newPswrd-addon"><b>#</b></span>
                        </div>
                        <input type="password" id="newPswrd" class="form-control" placeholder="Enter New Password..!"
                            aria-describedby="newPswrd-addon">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text" id="confPswrd-addon"><b>#</b></span>
                        </div>
                        <input type="password" id="confPswrd" class="form-control" placeholder="Confirm New Password..!"
                            aria-describedby="confPswrd-addon">
                    </div>
                    <div class="mb-3" align="center">
                        <button class="btn btn-danger btn-pswrd" style="width:48%;"
                            onclick="$('#chngePswd').modal('hide');"><b>B A C K</b></button>
                        <button class="btn btn-primary btn-pswrd" style="width:48%;" onclick="change()"><b>C H A N G
                                E</b></button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="WishModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
    aria-labelledby="WishModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <img src="gifs/crazy-robo.gif" alt="crazy-robo" class="happyRobo">
                <h2 class="modal-title" id="WishModalLabel" style="font-weight: bold; color: tomato;">Happy Birthday
                    Rajan...!</h2>
                <img src="gifs/crazy-robo.gif" alt="crazy-robo" class="happyRobo">
                <!-- <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button> -->
            </div>
            <div class="modal-body" style="text-align: justify;">
                <img src="Minions/happy-birthday-minions-3.gif" alt="Happy Birthday Minions" class="center">
                <!-- <video width="100%" height="240" autoplay>
                    <source src="Minions/Changing a light bulb Minion.mp4" type="video/mp4">
                </video> -->
                <h2 class="wishInfo"> &emsp;&emsp;Many Many Returns of the day in advance Rajkumar Bro. There is an
                    activity for your birthday celebration. Are you Ready..?</h2>
            </div>
            <div class="modal-footer">
                <!-- <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button> -->
                <img src="gifs/crazy-robo.gif" alt="crazy-robo" class="happyRobo">
                <a class="nav-link active" href="/wishes_rajan"><button class="btn btn-primary"
                        data-bs-dismiss="modal">Yes, Let's begin</button></a>
                <img src="gifs/crazy-robo.gif" alt="crazy-robo" class="happyRobo">
            </div>
        </div>
    </div>
</div>

<script>

    var origTitle;

    let PageParams = new URLSearchParams(window.location.search);

    $(document).ready(function () {
        origTitle = document.title;
        if (PageParams.has('login')) {
            $('#signIn').modal('show');
        }

        $('.modal').on('shown.bs.modal', function () {
            $(this).find('[autofocus]').focus();
        });
    });

    // function to change title when focusing on tab
    function oldTitle() { document.title = origTitle; }

    // function to change title when un-focusing on tab
    function newTitle() { document.title = 'You Left Me!'; }

    // bind functions to blur and focus events
    window.onblur = newTitle;
    window.onfocus = oldTitle;

    $("#loginForm").bind('submit', function (e) {
        $.ajax({
            type: 'POST',
            url: '/login',
            data: { 'LoginID': $('#Username').val(), 'Password': $('#Password').val() },
            datatype: 'json',
            contenttype: 'application/json',
            success: function ({ success, message }) {
                if (success) {
                    if (PageParams.has('redirect-to')) {
                        window.location.href = PageParams.get('redirect-to');
                    } else {
                        window.location.reload();
                    }
                } else {
                    $('#Credentials').addClass('animated wiggle');
                    setTimeout(() => $('#Credentials').removeClass('animated wiggle'), 500);
                }
            },
            error: function (err) {
                $('#Credentials').addClass('animated wiggle');
                setTimeout(() => $('#Credentials').removeClass('animated wiggle'), 500);
            }
        });
        e.preventDefault();
        return false;
    });

    function change() {
        var user_id = '<%-session.LoginID%>';
        var curpswrd = document.getElementById("curPswrd").value;
        var pswrd = document.getElementById("newPswrd").value;
        var pswrdRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
        if (!pswrdRegex.test(pswrd)) { alert("New Password should contain minimum 8 characters including atleast one Uppercase letter, one Lowercase letter, one Number and one Special character..!"); return; }
        var cnfpswrd = document.getElementById("confPswrd").value;
        if (pswrd != cnfpswrd) { alert("New Password and Confirm Password Didn't Matched..!"); return; }
        const userData = { "user_id": user_id, "curpswrd": curpswrd, "pswrd": pswrd };
        // console.log(userData);

        // e.preventDefault();
        $.ajax({
            url: '/change_password',
            type: 'POST',
            data: userData,
            success: function (result) {
                if (!result.success) {
                    alert(result.message);
                } else {
                    alert('Your Password have been changed Successfully. Enjoy Browsing!')
                    window.location.href = '/'
                }
            },
            error: function (err) { console.error(err); alert('Server Not Responding!'); }
        })
    }
</script>